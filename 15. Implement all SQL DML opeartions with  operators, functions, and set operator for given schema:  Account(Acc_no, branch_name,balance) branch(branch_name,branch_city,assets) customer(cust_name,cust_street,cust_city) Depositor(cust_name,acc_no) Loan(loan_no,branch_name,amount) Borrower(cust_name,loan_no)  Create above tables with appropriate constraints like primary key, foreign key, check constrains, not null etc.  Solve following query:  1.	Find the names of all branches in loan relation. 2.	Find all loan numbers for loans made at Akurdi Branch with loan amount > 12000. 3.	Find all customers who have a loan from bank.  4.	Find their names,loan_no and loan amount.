-- Use or create database
CREATE DATABASE IF NOT EXISTS bankDB2;
USE bankDB2;

-- Drop existing tables in dependency order
DROP TABLE IF EXISTS Borrower;
DROP TABLE IF EXISTS Loan;
DROP TABLE IF EXISTS Depositor;
DROP TABLE IF EXISTS Account;
DROP TABLE IF EXISTS Customer;
DROP TABLE IF EXISTS Branch;

-- ================================
-- Create tables with constraints
-- ================================

CREATE TABLE Branch (
    branch_name VARCHAR(50) PRIMARY KEY,
    branch_city VARCHAR(50) NOT NULL,
    assets INT NOT NULL CHECK (assets >= 0)
);

CREATE TABLE Customer (
    cust_name VARCHAR(50) PRIMARY KEY,
    cust_street VARCHAR(50) NOT NULL,
    cust_city VARCHAR(50) NOT NULL
);

CREATE TABLE Account (
    acc_no INT PRIMARY KEY,
    branch_name VARCHAR(50),
    balance INT NOT NULL CHECK (balance >= 0),
    FOREIGN KEY (branch_name) REFERENCES Branch(branch_name)
);

CREATE TABLE Depositor (
    cust_name VARCHAR(50),
    acc_no INT,
    FOREIGN KEY (cust_name) REFERENCES Customer(cust_name),
    FOREIGN KEY (acc_no) REFERENCES Account(acc_no),
    PRIMARY KEY (cust_name, acc_no)
);

CREATE TABLE Loan (
    loan_no INT PRIMARY KEY,
    branch_name VARCHAR(50),
    amount INT NOT NULL CHECK (amount > 0),
    FOREIGN KEY (branch_name) REFERENCES Branch(branch_name)
);

CREATE TABLE Borrower (
    cust_name VARCHAR(50),
    loan_no INT,
    FOREIGN KEY (cust_name) REFERENCES Customer(cust_name),
    FOREIGN KEY (loan_no) REFERENCES Loan(loan_no),
    PRIMARY KEY (cust_name, loan_no)
);

-- ================================
-- Insert sample data
-- ================================

INSERT INTO Branch VALUES 
('Akurdi', 'Pune', 800000),
('MG Road', 'Pune', 1000000),
('Churchgate', 'Mumbai', 1200000);

INSERT INTO Customer VALUES 
('Alice', 'MG Road', 'Pune'),
('Bob', 'Station Road', 'Mumbai'),
('Charlie', 'Karol Bagh', 'Delhi'),
('David', 'Baner', 'Pune');

INSERT INTO Account VALUES 
(201, 'MG Road', 15000),
(202, 'Akurdi', 18000),
(203, 'Churchgate', 22000);

INSERT INTO Depositor VALUES 
('Alice', 201),
('Bob', 202),
('Charlie', 203);

INSERT INTO Loan VALUES 
(301, 'Akurdi', 13000),
(302, 'MG Road', 25000),
(303, 'Akurdi', 11000),
(304, 'Churchgate', 20000);

INSERT INTO Borrower VALUES 
('Alice', 301),
('Bob', 302),
('Charlie', 303),
('David', 304);


-- 1. Find names of all branches in Loan relation
SELECT DISTINCT branch_name FROM Loan;

-- 2. Find all loan numbers at Akurdi branch with loan amount > 12000
SELECT loan_no 
FROM Loan 
WHERE branch_name = 'Akurdi' AND amount > 12000;

-- 3. Find all customers who have a loan from bank
SELECT DISTINCT cust_name FROM Borrower;

-- 4. Find their names, loan_no and loan amount
SELECT B.cust_name, L.loan_no, L.amount
FROM Borrower B
JOIN Loan L ON B.loan_no = L.loan_no;
